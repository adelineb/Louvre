{% extends "LouvreBilletterieBundle::layout.html.twig" %}

{% block title %}
    Billetterie - {{ parent() }}
{% endblock %}

{% block filariane %}
    <li>Date de la visite</li>
    <li>Informations</li>
    <li>Confirmation</li>
{% endblock %}


{% block main %}
        {{ form_start(form, {'attr': {'class': 'form-horizontal'}}) }}

        {# Les erreurs générales du formulaire. #}
        {{ form_errors(form) }}

        <fieldset>
            <legend>Vérifier votre commande & Paiement</legend>

            <div>
                {#<div class="col-xs-12 col-md-6">#}
                <table class="table table-bordered" id="recapCommande">
                    <thead class="thead-inverse">
                    <tr>
                        <th>Nom prénom</th>
                        <th>Tarif</th>
                        <th>Prix</th>
                    </tr>
                    </thead>
                    {% set i = 0 %}
                    {% set infos = app.session.get('Infos') %}
                    {% for billet in infos.getClients() %}
                    <tbody>
                    <tr>
                        <th> {{ billet.nom }} {{ billet.prenom }}</th>
                        {% if billet.tarif == "Réduit" %}
                            <th> {{ billet.tarif }} * </th>
                            {% set i = i + 1 %}
                        {% else %}
                            <th> {{ billet.tarif }} </th>
                        {% endif %}
                        <th> {{ billet.prix }} € </th>
                    </tr>
                    {% endfor %}
                    </tbody>
                    <tfoot>
                    <tr>
                        <th colspan="2" class="text-right"> Total </th>
                        <th> {{ app.session.get('Total')  }} € </th>
                    </tr>
                    </tfoot>
                </table>
                {#</div>#}
            </div>
            {% if i >= 1 %}
                <p><i> * Merci de vous munir d'un justificatif (carte d'étudiant, carte militaire, carte d'invalidité, etc.) le jour de votre visite.</i></p>
                <br/>
            {%  endif %}
            <div class="form-group">
                <label class="required">Paiement</label>
                {{ form_widget(form.paiement) }}
            </div>
            <div class="form-group">
                <label class="required">Email</label>
                {{ form_widget(form.email, {'attr': {'required': 'required'}}) }}
            </div>
            {{ form_widget(form._token) }}
        </fieldset>

        <div>
            <div style="text-align:right">
                <a href=""><input type="button" class="btn btn-danger" value="Annuler" /></a>
                <a href="{{ path('louvre_billetterie_infos') }}"><input type="button" class="btn btn-default" value="< Etape précédente" /></a>
                <input type="submit" class="btn btn-default" value="Etape suivante >" />
                <script
                        src="https://checkout.stripe.com/checkout.js" class="stripe-button"
                        {#data-key="pk_test_Z7CIYfAdyS4BYAwdNQHhUF1A"#}
                        data-key="{{ stripe_public_key }}"
                        {#data-email= "{{ email }}"#}
                        data-currency="eur"
                        data-amount="{{ montant * 100 }}"
                        data-name="Billet(s) musée du Louvre"
                        data-image="{{ asset('images/logo.jpg') }}"
                        data-locale="auto"
                        data-zip-code="true">
                </script>
            </div>
        </div>
        {{ form_end(form) }}
{% endblock %}

{% block aside %}
    <h4>Votre panier</h4>
    Visite pour le {{ app.session.get('date_visite')|date("d/m/Y") }}
    <hr />
    <!--à partir de-->
    Nombre de ticket(s) : {{ app.session.get('nb_billet') }}
    <div>
        {% set infos = app.session.get('Infos') %}
        <br>
        {% for billet in infos.getClients() %}

            <p>{{ billet.nom }}
                {{ billet.prenom }}
                {% if billet.tarif == "Réduit" %}
                    / Tarif {{ billet.tarif }} *
                {% else %}
                    / Tarif {{ billet.tarif }}
                {% endif %}
            </p>
        {% endfor %}

    </div>

    <hr />
    <div id="total" class="text-center">Total : {{ app.session.get('Total')  }} €</div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript" src="https://js.stripe.com/v2/"></script>
{% endblock %}